import{s as I}from"./index-BIFYNkZI.js";import{_ as N,r as D,k as B,w as U,o as f,a as e,c as m,e as w,t as i,d as k,F as C,l as O,v as z}from"./index-Dfs0tqaf.js";import{a as F}from"./axios-DsPaXkF5.js";const M={setup(){const u=D([]),_=D([]),y=D(""),n=async(a,o,t)=>{const c=a.target.files[0];if(c){const s=new FileReader;s.onload=async p=>{u.value[o][t]=p.target.result;const v=new FormData;v.append("file",c);try{const h=await F.post("/api/process-upload",v,{headers:{"Content-Type":"multipart/form-data"}});h.data.status==="success"?l(h.data.detections[0].message,o):h.data.status==="warning"&&l(h.data.new_data,o)}catch(h){console.error("Error uploading file:",h)}},s.readAsDataURL(c)}},g=(a,o)=>a===o?'<span class="text-green-500">Match</span>':'<span class="text-red-500">Not Match</span>',x=a=>{const{insured:o,buyer:t,dependents:c}=a;u.value=[{...o,type:"Insured",front:null,back:null},{...t,type:"Buyer",front:null,back:null},...c.map(s=>({...s,type:"Dependent",front:null,back:null}))],_.value=u.value.map(s=>{var p;return{NationalID:{oldData:s.nationalID,newData:""},CitizenID:{oldData:s.citizenID,newData:""},DateOfBirth:{oldData:b(s.dateOfBirth),newData:""},FullName:{oldData:s.fullName,newData:""},Address:{oldData:s.address,newData:""},Gender:{oldData:((p=s.gender)==null?void 0:p.name)||"",newData:""}}})},b=a=>{if(!a||a.length!==8)return a;const o=a.slice(0,2),t=a.slice(2,4),c=a.slice(4);return`${o}/${t}/${c}`},l=(a,o)=>{var s,p;console.log("Updated Data:",a);const t=u.value[o],c={NationalID:{oldData:t.nationalID,newData:a.id_identity_card||t.nationalID},CitizenID:{oldData:t.citizenID,newData:a.id_passport||t.citizenID},DateOfBirth:{oldData:t.dateOfBirth,newData:b(a.birth_date)||t.dateOfBirth},FullName:{oldData:t.fullName,newData:a.fullname||t.fullName},Address:{oldData:t.address,newData:a.address||t.address},Gender:{oldData:((s=t.gender)==null?void 0:s.name)||"",newData:a.gender||((p=t.gender)==null?void 0:p.name)||""}};_.value[o]=c},r=async a=>{try{if(a===null||a==="")console.warn("Không tìm thấy mã thụ lý.");else{const o=await F.get(`/v4/api/fortest/${a}`);x(o.data)}}catch(o){console.error("Failed to load buyer:",o)}},d=sessionStorage.getItem("CMI_ID");return!d||d==""||r(d),{people:u,comparisonData:_,notes:y,handleUpload:n,compareFields:g}}},j={class:"flex flex-col gap-8"},A={class:"card flex-1 flex flex-col gap-4 p-4"},L={class:"font-semibold text-xl"},T={class:"font-semibold text-xl"},R={class:"grid grid-cols-2 gap-4"},V={class:"flex flex-col gap-2"},E=["for"],G=["id","onChange"],H={class:"flex flex-col gap-2"},K=["for"],W=["id","onChange"],$={class:"flex items-center justify-center"},q={key:0,class:"w-full h-auto"},J=["src"],P={class:"flex items-center justify-center"},Q={key:0,class:"w-full h-auto"},X=["src"],Y={class:"card flex-1 flex flex-col gap-4 p-4"},Z={class:"font-semibold text-xl"},S={class:"min-w-full mt-4 border-separate border-spacing-2 border border-gray-300"},ee=e("thead",null,[e("tr",null,[e("th",{class:"border border-gray-400 px-4 py-2"},"Field"),e("th",{class:"border border-gray-400 px-4 py-2"},"Old Data"),e("th",{class:"border border-gray-400 px-4 py-2"},"New Data"),e("th",{class:"border border-gray-400 px-4 py-2"},"Comparison")])],-1),ae={class:"border border-gray-300 px-4 py-2"},te={class:"border border-gray-300 px-4 py-2"},oe={class:"border border-gray-300 px-4 py-2"},se=["innerHTML"],le={class:"card flex flex-col gap-4 p-4"},re=e("div",{class:"font-semibold text-xl"},"Notes",-1),de={class:"flex flex-col gap-2"},ne=e("label",{for:"notes",class:"font-medium"},"Notes",-1);function ce(u,_,y,n,g,x){const b=I;return f(),B(b,null,{default:U(()=>[e("div",j,[(f(!0),m(C,null,w(n.people,(l,r)=>(f(),m("div",{key:r,class:"flex flex-col md:flex-row gap-8 mb-8"},[e("div",A,[e("div",L,i(r+1)+". Upload ID Cards for "+i(l.type),1),e("div",T,i(l.fullName),1),e("div",R,[e("div",V,[e("label",{for:"front-upload-"+r,class:"font-medium"},"Upload Front Side",8,E),e("input",{id:"front-upload-"+r,type:"file",accept:"image/*",onChange:d=>n.handleUpload(d,r,"front"),class:"border rounded p-2"},null,40,G)]),e("div",H,[e("label",{for:"back-upload-"+r,class:"font-medium"},"Upload Back Side",8,K),e("input",{id:"back-upload-"+r,type:"file",accept:"image/*",onChange:d=>n.handleUpload(d,r,"back"),class:"border rounded p-2"},null,40,W)]),e("div",$,[l.front?(f(),m("div",q,[e("img",{src:l.front,width:"250",class:"object-cover border rounded"},null,8,J)])):k("",!0)]),e("div",P,[l.back?(f(),m("div",Q,[e("img",{src:l.back,width:"250",class:"object-cover border rounded"},null,8,X)])):k("",!0)])])]),e("div",Y,[e("div",Z,"Compare Data for "+i(l.type)+" "+i(r+1),1),e("table",S,[ee,e("tbody",null,[(f(!0),m(C,null,w(n.comparisonData[r],(d,a)=>(f(),m("tr",{key:a},[e("td",ae,i(a),1),e("td",te,i(d.oldData),1),e("td",oe,i(d.newData),1),e("td",{class:"border border-gray-300 px-4 py-2",innerHTML:n.compareFields(d.oldData,d.newData)},null,8,se)]))),128))])])])]))),128)),e("div",le,[re,e("div",de,[ne,O(e("textarea",{id:"notes",rows:"6","onUpdate:modelValue":_[0]||(_[0]=l=>n.notes=l),placeholder:"Add any additional notes here",class:"border rounded p-2"},null,512),[[z,n.notes]])])])])]),_:1})}const ue=N(M,[["render",ce]]);export{ue as default};
