import{s as B}from"./index-DeYra8QQ.js";import{_ as M,u as E,r as x,k as O,w as T,o as m,a as e,c as h,e as C,t as u,d as N,F as U,l as z,v as A}from"./index-Cz34KKLm.js";import{a as w}from"./axios-DsPaXkF5.js";const L={setup(){const p=E(),n=x([]),_=x([]),c=x(""),I=async(a,o,t)=>{const i=a.target.files[0];if(i){const s=new FileReader;s.onload=async f=>{n.value[o][t]=f.target.result;const v=new FormData;v.append("file",i);try{if((await w.post("/api/check-font",v,{headers:{"Content-Type":"multipart/form-data"}})).data.isFont)if(t=="front"){const D=await w.post("/api/process-upload",v,{headers:{"Content-Type":"multipart/form-data"}});D.data.status==="success"?(d(D.data.detections[0].message,o),p.add({severity:"success",summary:"Upload Success",detail:"File uploaded and processed successfully!",life:3e3})):D.data.status==="warning"&&(d(D.data.new_data,o),p.add({severity:"warn",summary:"Upload Warning",detail:"File uploaded with warnings. Please check!",life:3e3}))}else y(o,t),p.add({severity:"error",summary:"Upload Error",detail:"Hình ảnh mặt sau không phù hợp, vui lòng chọn lại!",life:5e3});else t=="front"&&(y(o,t),p.add({severity:"error",summary:"Upload Error",detail:"Vui lòng chọn hình ảnh rõ ràng hơn để đọc chính xác thông tin.!",life:5e3}))}catch(F){console.error("Error uploading file:",F),y(o,t),p.add({severity:"error",summary:"Upload Failed",detail:"Failed to upload the file. Please try again.",life:3e3})}},s.readAsDataURL(i)}},y=(a,o)=>{n.value[a][o]=null;const t=document.getElementById(`${o}-upload-${a}`);t&&(t.value="")},b=(a,o)=>a===o?'<span class="text-green-500">Match</span>':'<span class="text-red-500">Not Match</span>',r=a=>{const{insured:o,buyer:t,dependents:i}=a;n.value=[{...o,type:"Insured",front:null,back:null},{...t,type:"Buyer",front:null,back:null},...i.map(s=>({...s,type:"Dependent",front:null,back:null}))],_.value=n.value.map(s=>{var f;return{NationalID:{oldData:s.nationalID,newData:""},CitizenID:{oldData:s.citizenID,newData:""},DateOfBirth:{oldData:l(s.dateOfBirth),newData:""},FullName:{oldData:s.fullName,newData:""},Address:{oldData:s.address,newData:""},Gender:{oldData:((f=s.gender)==null?void 0:f.name)||"",newData:""}}})},l=a=>{if(!a||a.length!==8)return a;const o=a.slice(0,2),t=a.slice(2,4),i=a.slice(4);return`${o}/${t}/${i}`},d=(a,o)=>{var s,f;console.log("Updated Data:",a);const t=n.value[o],i={NationalID:{oldData:t.nationalID,newData:a.id_identity_card||t.nationalID},CitizenID:{oldData:t.citizenID,newData:a.id_passport||t.citizenID},DateOfBirth:{oldData:t.dateOfBirth,newData:l(a.birth_date)||t.dateOfBirth},FullName:{oldData:t.fullName,newData:a.fullname||t.fullName},Address:{oldData:t.address,newData:a.address||t.address},Gender:{oldData:((s=t.gender)==null?void 0:s.name)||"",newData:a.gender||((f=t.gender)==null?void 0:f.name)||""}};_.value[o]=i},g=async a=>{try{if(!a)p.add({severity:"warn",summary:"Missing ID",detail:"CMI_ID is missing. Please provide a valid ID.",life:3e3});else{const o=await w.get(`/v4/api/fortest/${a}`);r(o.data)}}catch(o){console.error("Failed to load buyer:",o),p.add({severity:"error",summary:"Data Load Error",detail:"Failed to load data. Please try again later.",life:3e3})}},k=sessionStorage.getItem("CMI_ID");return k&&g(k),{people:n,comparisonData:_,notes:c,handleUpload:I,compareFields:b}}},j={class:"flex flex-col gap-8"},P={class:"card flex-1 flex flex-col gap-4 p-4"},V={class:"font-semibold text-xl"},H={class:"font-semibold text-xl"},R={class:"grid grid-cols-2 gap-4"},$={class:"flex flex-col gap-2"},G=["for"],W=["id","onChange"],q={class:"flex flex-col gap-2"},J=["for"],K=["id","onChange"],Q={class:"flex items-center justify-center"},S={key:0,class:"w-full h-auto"},X=["src"],Y={class:"flex items-center justify-center"},Z={key:0,class:"w-full h-auto"},ee=["src"],ae={class:"card flex-1 flex flex-col gap-4 p-4"},te={class:"font-semibold text-xl"},oe={class:"min-w-full mt-4 border-separate border-spacing-2 border border-gray-300"},se=e("thead",null,[e("tr",null,[e("th",{class:"border border-gray-400 px-4 py-2"},"Field"),e("th",{class:"border border-gray-400 px-4 py-2"},"Old Data"),e("th",{class:"border border-gray-400 px-4 py-2"},"New Data"),e("th",{class:"border border-gray-400 px-4 py-2"},"Comparison")])],-1),le={class:"border border-gray-300 px-4 py-2"},re={class:"border border-gray-300 px-4 py-2"},de={class:"border border-gray-300 px-4 py-2"},ne=["innerHTML"],ce={class:"card flex flex-col gap-4 p-4"},ie=e("div",{class:"font-semibold text-xl"},"Notes",-1),pe={class:"flex flex-col gap-2"},ue=e("label",{for:"notes",class:"font-medium"},"Notes",-1);function fe(p,n,_,c,I,y){const b=B;return m(),O(b,null,{default:T(()=>[e("div",j,[(m(!0),h(U,null,C(c.people,(r,l)=>(m(),h("div",{key:l,class:"flex flex-col md:flex-row gap-8 mb-8"},[e("div",P,[e("div",V,u(l+1)+". Upload ID Cards for "+u(r.type),1),e("div",H,u(r.fullName),1),e("div",R,[e("div",$,[e("label",{for:"front-upload-"+l,class:"font-medium"},"Upload Front Side",8,G),e("input",{id:"front-upload-"+l,type:"file",accept:"image/*",onChange:d=>c.handleUpload(d,l,"front"),class:"border rounded p-2"},null,40,W)]),e("div",q,[e("label",{for:"back-upload-"+l,class:"font-medium"},"Upload Back Side",8,J),e("input",{id:"back-upload-"+l,type:"file",accept:"image/*",onChange:d=>c.handleUpload(d,l,"back"),class:"border rounded p-2"},null,40,K)]),e("div",Q,[r.front?(m(),h("div",S,[e("img",{src:r.front,width:"250",class:"object-cover border rounded"},null,8,X)])):N("",!0)]),e("div",Y,[r.back?(m(),h("div",Z,[e("img",{src:r.back,width:"250",class:"object-cover border rounded"},null,8,ee)])):N("",!0)])])]),e("div",ae,[e("div",te,"Compare Data for "+u(r.type)+" "+u(l+1),1),e("table",oe,[se,e("tbody",null,[(m(!0),h(U,null,C(c.comparisonData[l],(d,g)=>(m(),h("tr",{key:g},[e("td",le,u(g),1),e("td",re,u(d.oldData),1),e("td",de,u(d.newData),1),e("td",{class:"border border-gray-300 px-4 py-2",innerHTML:c.compareFields(d.oldData,d.newData)},null,8,ne)]))),128))])])])]))),128)),e("div",ce,[ie,e("div",pe,[ue,z(e("textarea",{id:"notes",rows:"6","onUpdate:modelValue":n[0]||(n[0]=r=>c.notes=r),placeholder:"Add any additional notes here",class:"border rounded p-2"},null,512),[[A,c.notes]])])])])]),_:1})}const ye=M(L,[["render",fe]]);export{ye as default};
