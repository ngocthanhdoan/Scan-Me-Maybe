import{s as B}from"./index-DSSL7r2a.js";import{_ as U,u as M,r as w,k as T,w as E,o as m,a as e,c as _,e as k,t as u,d as C,F as N,l as O,v as z}from"./index-DZibjDXc.js";import{a as x}from"./axios-DsPaXkF5.js";const A={setup(){const n=M(),c=w([]),D=w([]),i=w(""),F=async(a,o,t)=>{const p=a.target.files[0];if(p){const s=new FileReader;s.onload=async f=>{try{const y=new FormData;if(y.append("file",p),(await x.post("/api/check-font",y,{headers:{"Content-Type":"multipart/form-data"}})).data.isFont)if(t==="front"){const b=await x.post("/api/process-upload",y,{headers:{"Content-Type":"multipart/form-data"}});b.data.status==="success"?(d(b.data.detections[0].message,o),c.value[o][t]=f.target.result,n.add({severity:"success",summary:"Upload Success",detail:"File uploaded and processed successfully!",life:3e3})):b.data.status==="warning"&&(d(b.data.new_data,o),n.add({severity:"warn",summary:"Upload Warning",detail:"File uploaded with warnings. Please check!",life:3e3}))}else h(o,t),n.add({severity:"error",summary:"Invalid File",detail:"Back side upload is not valid!",life:3e3});else h(o,t),n.add({severity:"error",summary:"Invalid File",detail:"The file is not valid!",life:3e3})}catch(y){console.error("Error uploading file:",y),h(o,t),n.add({severity:"error",summary:"Upload Failed",detail:"Failed to upload the file. Please upload again.",life:3e3})}},s.onerror=()=>{console.error("Error reading file:",s.error),h(o,t),n.add({severity:"error",summary:"File Read Error",detail:"Failed to read the file. Please upload again.",life:3e3})},s.readAsDataURL(p)}},h=(a,o)=>{c.value[a][o]=null;const t=document.getElementById(`${o}-upload-${a}`);t&&(t.value="")},v=(a,o)=>a===o?'<span class="text-green-500">Match</span>':'<span class="text-red-500">Not Match</span>',r=a=>{const{insured:o,buyer:t,dependents:p}=a;c.value=[{...o,type:"Insured",front:null,back:null},{...t,type:"Buyer",front:null,back:null},...p.map(s=>({...s,type:"Dependent",front:null,back:null}))],D.value=c.value.map(s=>{var f;return{NationalID:{oldData:s.nationalID,newData:""},CitizenID:{oldData:s.citizenID,newData:""},DateOfBirth:{oldData:l(s.dateOfBirth),newData:""},FullName:{oldData:s.fullName,newData:""},Address:{oldData:s.address,newData:""},Gender:{oldData:((f=s.gender)==null?void 0:f.name)||"",newData:""}}})},l=a=>{if(!a||a.length!==8)return a;const o=a.slice(0,2),t=a.slice(2,4),p=a.slice(4);return`${o}/${t}/${p}`},d=(a,o)=>{var s,f;console.log("Updated Data:",a);const t=c.value[o],p={NationalID:{oldData:t.nationalID,newData:a.id_identity_card||t.nationalID},CitizenID:{oldData:t.citizenID,newData:a.id_passport||t.citizenID},DateOfBirth:{oldData:t.dateOfBirth,newData:l(a.birth_date)||t.dateOfBirth},FullName:{oldData:t.fullName,newData:a.fullname||t.fullName},Address:{oldData:t.address,newData:a.address||t.address},Gender:{oldData:((s=t.gender)==null?void 0:s.name)||"",newData:a.gender||((f=t.gender)==null?void 0:f.name)||""}};D.value[o]=p},g=async a=>{try{if(!a)n.add({severity:"warn",summary:"Missing ID",detail:"CMI_ID is missing. Please provide a valid ID.",life:3e3});else{const o=await x.get(`/v4/api/fortest/${a}`);r(o.data)}}catch(o){console.error("Failed to load buyer:",o),n.add({severity:"error",summary:"Data Load Error",detail:"Failed to load data. Please try again later.",life:3e3})}},I=sessionStorage.getItem("CMI_ID");return I&&g(I),{people:c,comparisonData:D,notes:i,handleUpload:F,compareFields:v}}},L={class:"flex flex-col gap-8"},P={class:"card flex-1 flex flex-col gap-4 p-4"},j={class:"font-semibold text-xl"},R={class:"font-semibold text-xl"},V={class:"grid grid-cols-2 gap-4"},$={class:"flex flex-col gap-2"},G=["for"],H=["id","onChange"],W={class:"flex flex-col gap-2"},q=["for"],J=["id","onChange"],K={class:"flex items-center justify-center"},Q={key:0,class:"w-full h-auto"},S=["src"],X={class:"flex items-center justify-center"},Y={key:0,class:"w-full h-auto"},Z=["src"],ee={class:"card flex-1 flex flex-col gap-4 p-4"},ae={class:"font-semibold text-xl"},te={class:"min-w-full mt-4 border-separate border-spacing-2 border border-gray-300"},oe=e("thead",null,[e("tr",null,[e("th",{class:"border border-gray-400 px-4 py-2"},"Field"),e("th",{class:"border border-gray-400 px-4 py-2"},"Old Data"),e("th",{class:"border border-gray-400 px-4 py-2"},"New Data"),e("th",{class:"border border-gray-400 px-4 py-2"},"Comparison")])],-1),se={class:"border border-gray-300 px-4 py-2"},le={class:"border border-gray-300 px-4 py-2"},re={class:"border border-gray-300 px-4 py-2"},de=["innerHTML"],ne={class:"card flex flex-col gap-4 p-4"},ce=e("div",{class:"font-semibold text-xl"},"Notes",-1),ie={class:"flex flex-col gap-2"},pe=e("label",{for:"notes",class:"font-medium"},"Notes",-1);function ue(n,c,D,i,F,h){const v=B;return m(),T(v,null,{default:E(()=>[e("div",L,[(m(!0),_(N,null,k(i.people,(r,l)=>(m(),_("div",{key:l,class:"flex flex-col md:flex-row gap-8 mb-8"},[e("div",P,[e("div",j,u(l+1)+". Upload ID Cards for "+u(r.type),1),e("div",R,u(r.fullName),1),e("div",V,[e("div",$,[e("label",{for:"front-upload-"+l,class:"font-medium"},"Upload Front Side",8,G),e("input",{id:"front-upload-"+l,type:"file",accept:"image/*",onChange:d=>i.handleUpload(d,l,"front"),class:"border rounded p-2"},null,40,H)]),e("div",W,[e("label",{for:"back-upload-"+l,class:"font-medium"},"Upload Back Side",8,q),e("input",{id:"back-upload-"+l,type:"file",accept:"image/*",onChange:d=>i.handleUpload(d,l,"back"),class:"border rounded p-2"},null,40,J)]),e("div",K,[r.front?(m(),_("div",Q,[e("img",{src:r.front,width:"250",class:"object-cover border rounded"},null,8,S)])):C("",!0)]),e("div",X,[r.back?(m(),_("div",Y,[e("img",{src:r.back,width:"250",class:"object-cover border rounded"},null,8,Z)])):C("",!0)])])]),e("div",ee,[e("div",ae,"Compare Data for "+u(r.type)+" "+u(l+1),1),e("table",te,[oe,e("tbody",null,[(m(!0),_(N,null,k(i.comparisonData[l],(d,g)=>(m(),_("tr",{key:g},[e("td",se,u(g),1),e("td",le,u(d.oldData),1),e("td",re,u(d.newData),1),e("td",{class:"border border-gray-300 px-4 py-2",innerHTML:i.compareFields(d.oldData,d.newData)},null,8,de)]))),128))])])])]))),128)),e("div",ne,[ce,e("div",ie,[pe,O(e("textarea",{id:"notes",rows:"6","onUpdate:modelValue":c[0]||(c[0]=r=>i.notes=r),placeholder:"Add any additional notes here",class:"border rounded p-2"},null,512),[[z,i.notes]])])])])]),_:1})}const ye=U(A,[["render",ue]]);export{ye as default};
