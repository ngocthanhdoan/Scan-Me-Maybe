import{s as M}from"./index-b-9_rQyT.js";import{_ as A,u as E,r as x,k as O,w as T,o as m,a,c as h,e as C,t as f,d as U,F as N,l as V,v as z}from"./index-B-QDjk9x.js";import{a as w}from"./axios-DsPaXkF5.js";const L={setup(){const n=E(),l=x([]),g=x([]),c=x(""),k=async(t,o,e)=>{const p=t.target.files[0];if(p){const s=new FileReader;s.onload=async u=>{l.value[o][e]=u.target.result;const v=new FormData;v.append("file",p);try{if((await w.post("/api/check-font",v,{headers:{"Content-Type":"multipart/form-data"}})).data.isFont)if(e=="front"){const b=await w.post("/api/process-upload",v,{headers:{"Content-Type":"multipart/form-data"}});b.data.status==="success"?(y(b.data.detections[0].message,o),n.add({severity:"success",summary:"Upload Success",detail:"File uploaded and processed successfully!",life:3e3})):b.data.status==="warning"?(y(b.data.new_data,o),n.add({severity:"warn",summary:"Upload Warning",detail:"File uploaded with warnings. Please check!",life:3e3})):(_(o,e),n.add({severity:"error",summary:"Upload Error",detail:"Vui lòng chọn hình ảnh rõ ràng hơn để đọc chính xác thông tin.!",life:5e3}))}else _(o,e),n.add({severity:"error",summary:"Upload Error",detail:"Hình ảnh mặt sau không phù hợp, vui lòng chọn lại!",life:5e3});else e=="front"&&(_(o,e),n.add({severity:"error",summary:"Upload Error",detail:"Vui lòng chọn hình ảnh rõ ràng hơn để đọc chính xác thông tin.!",life:5e3}))}catch(F){console.error("Error uploading file:",F),_(o,e),n.add({severity:"error",summary:"Upload Failed",detail:"Failed to upload the file. Please try again.",life:3e3})}},s.readAsDataURL(p)}},_=(t,o)=>{l.value[t][o]=null;const e=document.getElementById(`${o}-upload-${t}`);e&&(e.value="")},D=(t,o)=>t===o?'<span class="text-green-500">Match</span>':'<span class="text-red-500">Not Match</span>',r=()=>{let t=!0;for(let o=0;o<l.value.length;o++){const e=l.value[o];(!e.front||!e.back)&&(t=!1,n.add({severity:"warn",summary:"Incomplete Uploads",detail:`Please upload both front and back images for ${e.type} ${o+1}.`,life:5e3}))}t&&n.add({severity:"success",summary:"All Good",detail:"All images are uploaded. You can now proceed.",life:3e3})},d=t=>{const{insured:o,buyer:e,dependents:p}=t;l.value=[{...o,type:"Insured",front:null,back:null},{...e,type:"Buyer",front:null,back:null},...p.map(s=>({...s,type:"Dependent",front:null,back:null}))],g.value=l.value.map(s=>{var u;return{NationalID:{oldData:s.nationalID,newData:""},CitizenID:{oldData:s.citizenID,newData:""},DateOfBirth:{oldData:i(s.dateOfBirth),newData:""},FullName:{oldData:s.fullName,newData:""},Address:{oldData:s.address,newData:""},Gender:{oldData:((u=s.gender)==null?void 0:u.name)||"",newData:""}}})},i=t=>{if(!t||t.length!==8)return t;const o=t.slice(0,2),e=t.slice(2,4),p=t.slice(4);return`${o}/${e}/${p}`},y=(t,o)=>{var s,u;console.log("Updated Data:",t);const e=l.value[o],p={NationalID:{oldData:e.nationalID,newData:t.id_identity_card||e.nationalID},CitizenID:{oldData:e.citizenID,newData:t.id_passport||e.citizenID},DateOfBirth:{oldData:e.dateOfBirth,newData:i(t.birth_date)||e.dateOfBirth},FullName:{oldData:e.fullName,newData:t.fullname||e.fullName},Address:{oldData:e.address,newData:t.address||e.address},Gender:{oldData:((s=e.gender)==null?void 0:s.name)||"",newData:t.gender||((u=e.gender)==null?void 0:u.name)||""}};g.value[o]=p},B=async t=>{try{if(!t)n.add({severity:"warn",summary:"Missing ID",detail:"CMI_ID is missing. Please provide a valid ID.",life:3e3});else{const o=await w.get(`/v4/api/fortest/${t}`);d(o.data)}}catch(o){console.error("Failed to load buyer:",o),n.add({severity:"error",summary:"Data Load Error",detail:"Failed to load data. Please try again later.",life:3e3})}},I=sessionStorage.getItem("CMI_ID");return I&&B(I),{people:l,comparisonData:g,notes:c,handleUpload:k,compareFields:D,validateUploads:r}}},P={class:"flex flex-col gap-8"},j={class:"card flex-1 flex flex-col gap-4 p-4"},G={class:"font-semibold text-xl"},H={class:"font-semibold text-xl"},R={class:"grid grid-cols-2 gap-4"},$={class:"flex flex-col gap-2"},W=["for"],Y=["id","onChange"],q={class:"flex flex-col gap-2"},J=["for"],K=["id","onChange"],Q={class:"flex items-center justify-center"},S={key:0,class:"w-full h-auto"},X=["src"],Z={class:"flex items-center justify-center"},aa={key:0,class:"w-full h-auto"},ea=["src"],ta={class:"card flex-1 flex flex-col gap-4 p-4"},oa={class:"font-semibold text-xl"},sa={class:"min-w-full mt-4 border-separate border-spacing-2 border border-gray-300"},la=a("thead",null,[a("tr",null,[a("th",{class:"border border-gray-400 px-4 py-2"},"Field"),a("th",{class:"border border-gray-400 px-4 py-2"},"Old Data"),a("th",{class:"border border-gray-400 px-4 py-2"},"New Data"),a("th",{class:"border border-gray-400 px-4 py-2"},"Comparison")])],-1),ra={class:"border border-gray-300 px-4 py-2"},da={class:"border border-gray-300 px-4 py-2"},na={class:"border border-gray-300 px-4 py-2"},ca=["innerHTML"],ia={class:"card flex flex-col gap-4 p-4"},pa=a("div",{class:"font-semibold text-xl"},"Notes",-1),fa={class:"flex flex-col gap-2"},ua=a("label",{for:"notes",class:"font-medium"},"Notes",-1),ma={class:"card flex flex-col gap-4 p-4"};function ha(n,l,g,c,k,_){const D=M;return m(),O(D,null,{default:T(()=>[a("div",P,[(m(!0),h(N,null,C(c.people,(r,d)=>(m(),h("div",{key:d,class:"flex flex-col md:flex-row gap-8 mb-8"},[a("div",j,[a("div",G,f(d+1)+". Upload ID Cards for "+f(r.type),1),a("div",H,f(r.fullName),1),a("div",R,[a("div",$,[a("label",{for:"front-upload-"+d,class:"font-medium"},"Upload Front Side",8,W),a("input",{id:"front-upload-"+d,type:"file",accept:"image/*",onChange:i=>c.handleUpload(i,d,"front"),class:"border rounded p-2"},null,40,Y)]),a("div",q,[a("label",{for:"back-upload-"+d,class:"font-medium"},"Upload Back Side",8,J),a("input",{id:"back-upload-"+d,type:"file",accept:"image/*",onChange:i=>c.handleUpload(i,d,"back"),class:"border rounded p-2"},null,40,K)]),a("div",Q,[r.front?(m(),h("div",S,[a("img",{src:r.front,width:"250",class:"object-cover border rounded"},null,8,X)])):U("",!0)]),a("div",Z,[r.back?(m(),h("div",aa,[a("img",{src:r.back,width:"250",class:"object-cover border rounded"},null,8,ea)])):U("",!0)])])]),a("div",ta,[a("div",oa,"Compare Data for "+f(r.type)+" "+f(d+1),1),a("table",sa,[la,a("tbody",null,[(m(!0),h(N,null,C(c.comparisonData[d],(i,y)=>(m(),h("tr",{key:y},[a("td",ra,f(y),1),a("td",da,f(i.oldData),1),a("td",na,f(i.newData),1),a("td",{class:"border border-gray-300 px-4 py-2",innerHTML:c.compareFields(i.oldData,i.newData)},null,8,ca)]))),128))])])])]))),128)),a("div",ia,[pa,a("div",fa,[ua,V(a("textarea",{id:"notes",rows:"6","onUpdate:modelValue":l[0]||(l[0]=r=>c.notes=r),placeholder:"Add any additional notes here",class:"border rounded p-2"},null,512),[[z,c.notes]])])]),a("div",ma,[a("button",{onClick:l[1]||(l[1]=(...r)=>c.validateUploads&&c.validateUploads(...r)),class:"btn btn-primary"},"Cập nhật")])])]),_:1})}const ba=A(L,[["render",ha]]);export{ba as default};
