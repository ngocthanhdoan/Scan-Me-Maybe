import{s as B}from"./index-BHZzfzZs.js";import{_ as M,u as E,r as x,k as O,w as T,o as h,a as e,c as m,e as C,t as u,d as U,F as N,l as z,v as A}from"./index-HuSBWuOd.js";import{a as w}from"./axios-DsPaXkF5.js";const L={setup(){const n=E(),c=x([]),y=x([]),i=x(""),I=async(t,o,a)=>{const p=t.target.files[0];if(p){const s=new FileReader;s.onload=async f=>{c.value[o][a]=f.target.result;const v=new FormData;v.append("file",p);try{if((await w.post("/api/check-font",v,{headers:{"Content-Type":"multipart/form-data"}})).data.isFont)if(a=="front"){const D=await w.post("/api/process-upload",v,{headers:{"Content-Type":"multipart/form-data"}});D.data.status==="success"?(d(D.data.detections[0].message,o),n.add({severity:"success",summary:"Upload Success",detail:"File uploaded and processed successfully!",life:3e3})):D.data.status==="warning"?(d(D.data.new_data,o),n.add({severity:"warn",summary:"Upload Warning",detail:"File uploaded with warnings. Please check!",life:3e3})):(_(o,a),n.add({severity:"error",summary:"Upload Error",detail:"Vui lòng chọn hình ảnh rõ ràng hơn để đọc chính xác thông tin.!",life:5e3}))}else _(o,a),n.add({severity:"error",summary:"Upload Error",detail:"Hình ảnh mặt sau không phù hợp, vui lòng chọn lại!",life:5e3});else a=="front"&&(_(o,a),n.add({severity:"error",summary:"Upload Error",detail:"Vui lòng chọn hình ảnh rõ ràng hơn để đọc chính xác thông tin.!",life:5e3}))}catch(F){console.error("Error uploading file:",F),_(o,a),n.add({severity:"error",summary:"Upload Failed",detail:"Failed to upload the file. Please try again.",life:3e3})}},s.readAsDataURL(p)}},_=(t,o)=>{c.value[t][o]=null;const a=document.getElementById(`${o}-upload-${t}`);a&&(a.value="")},b=(t,o)=>t===o?'<span class="text-green-500">Match</span>':'<span class="text-red-500">Not Match</span>',r=t=>{const{insured:o,buyer:a,dependents:p}=t;c.value=[{...o,type:"Insured",front:null,back:null},{...a,type:"Buyer",front:null,back:null},...p.map(s=>({...s,type:"Dependent",front:null,back:null}))],y.value=c.value.map(s=>{var f;return{NationalID:{oldData:s.nationalID,newData:""},CitizenID:{oldData:s.citizenID,newData:""},DateOfBirth:{oldData:l(s.dateOfBirth),newData:""},FullName:{oldData:s.fullName,newData:""},Address:{oldData:s.address,newData:""},Gender:{oldData:((f=s.gender)==null?void 0:f.name)||"",newData:""}}})},l=t=>{if(!t||t.length!==8)return t;const o=t.slice(0,2),a=t.slice(2,4),p=t.slice(4);return`${o}/${a}/${p}`},d=(t,o)=>{var s,f;console.log("Updated Data:",t);const a=c.value[o],p={NationalID:{oldData:a.nationalID,newData:t.id_identity_card||a.nationalID},CitizenID:{oldData:a.citizenID,newData:t.id_passport||a.citizenID},DateOfBirth:{oldData:a.dateOfBirth,newData:l(t.birth_date)||a.dateOfBirth},FullName:{oldData:a.fullName,newData:t.fullname||a.fullName},Address:{oldData:a.address,newData:t.address||a.address},Gender:{oldData:((s=a.gender)==null?void 0:s.name)||"",newData:t.gender||((f=a.gender)==null?void 0:f.name)||""}};y.value[o]=p},g=async t=>{try{if(!t)n.add({severity:"warn",summary:"Missing ID",detail:"CMI_ID is missing. Please provide a valid ID.",life:3e3});else{const o=await w.get(`/v4/api/fortest/${t}`);r(o.data)}}catch(o){console.error("Failed to load buyer:",o),n.add({severity:"error",summary:"Data Load Error",detail:"Failed to load data. Please try again later.",life:3e3})}},k=sessionStorage.getItem("CMI_ID");return k&&g(k),{people:c,comparisonData:y,notes:i,handleUpload:I,compareFields:b}}},V={class:"flex flex-col gap-8"},j={class:"card flex-1 flex flex-col gap-4 p-4"},P={class:"font-semibold text-xl"},H={class:"font-semibold text-xl"},R={class:"grid grid-cols-2 gap-4"},$={class:"flex flex-col gap-2"},G=["for"],W=["id","onChange"],q={class:"flex flex-col gap-2"},J=["for"],K=["id","onChange"],Q={class:"flex items-center justify-center"},S={key:0,class:"w-full h-auto"},X=["src"],Y={class:"flex items-center justify-center"},Z={key:0,class:"w-full h-auto"},ee=["src"],ae={class:"card flex-1 flex flex-col gap-4 p-4"},te={class:"font-semibold text-xl"},oe={class:"min-w-full mt-4 border-separate border-spacing-2 border border-gray-300"},se=e("thead",null,[e("tr",null,[e("th",{class:"border border-gray-400 px-4 py-2"},"Field"),e("th",{class:"border border-gray-400 px-4 py-2"},"Old Data"),e("th",{class:"border border-gray-400 px-4 py-2"},"New Data"),e("th",{class:"border border-gray-400 px-4 py-2"},"Comparison")])],-1),le={class:"border border-gray-300 px-4 py-2"},re={class:"border border-gray-300 px-4 py-2"},de={class:"border border-gray-300 px-4 py-2"},ne=["innerHTML"],ce={class:"card flex flex-col gap-4 p-4"},ie=e("div",{class:"font-semibold text-xl"},"Notes",-1),pe={class:"flex flex-col gap-2"},ue=e("label",{for:"notes",class:"font-medium"},"Notes",-1);function fe(n,c,y,i,I,_){const b=B;return h(),O(b,null,{default:T(()=>[e("div",V,[(h(!0),m(N,null,C(i.people,(r,l)=>(h(),m("div",{key:l,class:"flex flex-col md:flex-row gap-8 mb-8"},[e("div",j,[e("div",P,u(l+1)+". Upload ID Cards for "+u(r.type),1),e("div",H,u(r.fullName),1),e("div",R,[e("div",$,[e("label",{for:"front-upload-"+l,class:"font-medium"},"Upload Front Side",8,G),e("input",{id:"front-upload-"+l,type:"file",accept:"image/*",onChange:d=>i.handleUpload(d,l,"front"),class:"border rounded p-2"},null,40,W)]),e("div",q,[e("label",{for:"back-upload-"+l,class:"font-medium"},"Upload Back Side",8,J),e("input",{id:"back-upload-"+l,type:"file",accept:"image/*",onChange:d=>i.handleUpload(d,l,"back"),class:"border rounded p-2"},null,40,K)]),e("div",Q,[r.front?(h(),m("div",S,[e("img",{src:r.front,width:"250",class:"object-cover border rounded"},null,8,X)])):U("",!0)]),e("div",Y,[r.back?(h(),m("div",Z,[e("img",{src:r.back,width:"250",class:"object-cover border rounded"},null,8,ee)])):U("",!0)])])]),e("div",ae,[e("div",te,"Compare Data for "+u(r.type)+" "+u(l+1),1),e("table",oe,[se,e("tbody",null,[(h(!0),m(N,null,C(i.comparisonData[l],(d,g)=>(h(),m("tr",{key:g},[e("td",le,u(g),1),e("td",re,u(d.oldData),1),e("td",de,u(d.newData),1),e("td",{class:"border border-gray-300 px-4 py-2",innerHTML:i.compareFields(d.oldData,d.newData)},null,8,ne)]))),128))])])])]))),128)),e("div",ce,[ie,e("div",pe,[ue,z(e("textarea",{id:"notes",rows:"6","onUpdate:modelValue":c[0]||(c[0]=r=>i.notes=r),placeholder:"Add any additional notes here",class:"border rounded p-2"},null,512),[[A,i.notes]])])])])]),_:1})}const ye=M(L,[["render",fe]]);export{ye as default};
