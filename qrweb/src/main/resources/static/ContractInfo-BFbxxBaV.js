import{s as U}from"./index-DCuTXhpR.js";import{_ as B,u as M,r as v,k as O,w as T,o as m,a as e,c as _,e as I,t as p,d as C,F as N,l as z,v as L}from"./index-D1Qu7unh.js";import{a as x}from"./axios-DsPaXkF5.js";const j={setup(){const f=M(),i=v([]),y=v([]),n=v(""),w=async(a,o,t)=>{const c=a.target.files[0];if(c){const s=new FileReader;s.onload=async u=>{i.value[o][t]=u.target.result;const g=new FormData;g.append("file",c);try{if((await x.post("/api/check-font",g,{headers:{"Content-Type":"multipart/form-data"}})).data.isFont)if(t=="front"){const D=await x.post("/api/process-upload",g,{headers:{"Content-Type":"multipart/form-data"}});D.data.status==="success"?(l(D.data.detections[0].message,o),f.add({severity:"success",summary:"Upload Success",detail:"File uploaded and processed successfully!",life:3e3})):D.data.status==="warning"&&(l(D.data.new_data,o),f.add({severity:"warn",summary:"Upload Warning",detail:"File uploaded with warnings. Please check!",life:3e3}))}else f.add({severity:"error",summary:"Upload Error",detail:"Back side upload is not valid!",life:3e3})}catch(F){console.error("Error uploading file:",F),f.add({severity:"error",summary:"Upload Failed",detail:"Failed to upload the file. Please try again.",life:3e3})}},s.readAsDataURL(c)}},k=(a,o)=>a===o?'<span class="text-green-500">Match</span>':'<span class="text-red-500">Not Match</span>',b=a=>{const{insured:o,buyer:t,dependents:c}=a;i.value=[{...o,type:"Insured",front:null,back:null},{...t,type:"Buyer",front:null,back:null},...c.map(s=>({...s,type:"Dependent",front:null,back:null}))],y.value=i.value.map(s=>{var u;return{NationalID:{oldData:s.nationalID,newData:""},CitizenID:{oldData:s.citizenID,newData:""},DateOfBirth:{oldData:r(s.dateOfBirth),newData:""},FullName:{oldData:s.fullName,newData:""},Address:{oldData:s.address,newData:""},Gender:{oldData:((u=s.gender)==null?void 0:u.name)||"",newData:""}}})},r=a=>{if(!a||a.length!==8)return a;const o=a.slice(0,2),t=a.slice(2,4),c=a.slice(4);return`${o}/${t}/${c}`},l=(a,o)=>{var s,u;console.log("Updated Data:",a);const t=i.value[o],c={NationalID:{oldData:t.nationalID,newData:a.id_identity_card||t.nationalID},CitizenID:{oldData:t.citizenID,newData:a.id_passport||t.citizenID},DateOfBirth:{oldData:t.dateOfBirth,newData:r(a.birth_date)||t.dateOfBirth},FullName:{oldData:t.fullName,newData:a.fullname||t.fullName},Address:{oldData:t.address,newData:a.address||t.address},Gender:{oldData:((s=t.gender)==null?void 0:s.name)||"",newData:a.gender||((u=t.gender)==null?void 0:u.name)||""}};y.value[o]=c},d=async a=>{try{if(!a)f.add({severity:"warn",summary:"Missing ID",detail:"CMI_ID is missing. Please provide a valid ID.",life:3e3});else{const o=await x.get(`/v4/api/fortest/${a}`);b(o.data)}}catch(o){console.error("Failed to load buyer:",o),f.add({severity:"error",summary:"Data Load Error",detail:"Failed to load data. Please try again later.",life:3e3})}},h=sessionStorage.getItem("CMI_ID");return h&&d(h),{people:i,comparisonData:y,notes:n,handleUpload:w,compareFields:k}}},A={class:"flex flex-col gap-8"},E={class:"card flex-1 flex flex-col gap-4 p-4"},P={class:"font-semibold text-xl"},R={class:"font-semibold text-xl"},V={class:"grid grid-cols-2 gap-4"},G={class:"flex flex-col gap-2"},H=["for"],W=["id","onChange"],$={class:"flex flex-col gap-2"},q=["for"],J=["id","onChange"],K={class:"flex items-center justify-center"},Q={key:0,class:"w-full h-auto"},S=["src"],X={class:"flex items-center justify-center"},Y={key:0,class:"w-full h-auto"},Z=["src"],ee={class:"card flex-1 flex flex-col gap-4 p-4"},ae={class:"font-semibold text-xl"},te={class:"min-w-full mt-4 border-separate border-spacing-2 border border-gray-300"},oe=e("thead",null,[e("tr",null,[e("th",{class:"border border-gray-400 px-4 py-2"},"Field"),e("th",{class:"border border-gray-400 px-4 py-2"},"Old Data"),e("th",{class:"border border-gray-400 px-4 py-2"},"New Data"),e("th",{class:"border border-gray-400 px-4 py-2"},"Comparison")])],-1),se={class:"border border-gray-300 px-4 py-2"},le={class:"border border-gray-300 px-4 py-2"},re={class:"border border-gray-300 px-4 py-2"},de=["innerHTML"],ne={class:"card flex flex-col gap-4 p-4"},ce=e("div",{class:"font-semibold text-xl"},"Notes",-1),ie={class:"flex flex-col gap-2"},pe=e("label",{for:"notes",class:"font-medium"},"Notes",-1);function fe(f,i,y,n,w,k){const b=U;return m(),O(b,null,{default:T(()=>[e("div",A,[(m(!0),_(N,null,I(n.people,(r,l)=>(m(),_("div",{key:l,class:"flex flex-col md:flex-row gap-8 mb-8"},[e("div",E,[e("div",P,p(l+1)+". Upload ID Cards for "+p(r.type),1),e("div",R,p(r.fullName),1),e("div",V,[e("div",G,[e("label",{for:"front-upload-"+l,class:"font-medium"},"Upload Front Side",8,H),e("input",{id:"front-upload-"+l,type:"file",accept:"image/*",onChange:d=>n.handleUpload(d,l,"front"),class:"border rounded p-2"},null,40,W)]),e("div",$,[e("label",{for:"back-upload-"+l,class:"font-medium"},"Upload Back Side",8,q),e("input",{id:"back-upload-"+l,type:"file",accept:"image/*",onChange:d=>n.handleUpload(d,l,"back"),class:"border rounded p-2"},null,40,J)]),e("div",K,[r.front?(m(),_("div",Q,[e("img",{src:r.front,width:"250",class:"object-cover border rounded"},null,8,S)])):C("",!0)]),e("div",X,[r.back?(m(),_("div",Y,[e("img",{src:r.back,width:"250",class:"object-cover border rounded"},null,8,Z)])):C("",!0)])])]),e("div",ee,[e("div",ae,"Compare Data for "+p(r.type)+" "+p(l+1),1),e("table",te,[oe,e("tbody",null,[(m(!0),_(N,null,I(n.comparisonData[l],(d,h)=>(m(),_("tr",{key:h},[e("td",se,p(h),1),e("td",le,p(d.oldData),1),e("td",re,p(d.newData),1),e("td",{class:"border border-gray-300 px-4 py-2",innerHTML:n.compareFields(d.oldData,d.newData)},null,8,de)]))),128))])])])]))),128)),e("div",ne,[ce,e("div",ie,[pe,z(e("textarea",{id:"notes",rows:"6","onUpdate:modelValue":i[0]||(i[0]=r=>n.notes=r),placeholder:"Add any additional notes here",class:"border rounded p-2"},null,512),[[L,n.notes]])])])])]),_:1})}const he=B(j,[["render",fe]]);export{he as default};
